(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8805],{68805:function(e,t,n){"use strict";n.d(t,{Z:function(){return K},F:function(){return R}});var r=n(47568),i=n(26042),a=n(69396),s=n(29815),o=n(70655),l=n(85893),u=n(2337),d=n(67294),c=n(58533),m=n(36589),f=n(40006),v=n(11163),p=n(13344),h=n(14108),g=n(59830),x=n(9669),b=n.n(x),y=n(33299),w=function(e){var t,n,a,l=e.initialImages,u=e.initialCursor,c=e.options,m=e.sortBy,f=e.filter,v=(0,d.useState)(l),p=v[0],h=v[1],x=(0,d.useState)(u),w=x[0],j=x[1],C=(0,y.useSession)(),Z=(0,d.useState)(!1),k=Z[0],I=Z[1],M=(0,d.useRef)({sortBy:m,filter:f}),S=(0,d.useCallback)((a=(0,r.Z)(function(e){var t,n,r,a,s,l;return(0,o.__generator)(this,function(r){switch(r.label){case 0:return[4,b().get(c.url,{params:(0,i.Z)({limit:g.NM,cursor:e,userId:null==C?void 0:null===(t=C.data)||void 0===t?void 0:null===(n=t.user)||void 0===n?void 0:n.id},c.params)})];case 1:return[2,{newImages:s=(a=r.sent().data).images,newCursor:a.cursor,nasMoreImages:void 0!==e}]}})}),function(e){return a.apply(this,arguments)}),[c.params,c.url,null==C?void 0:null===(t=C.data)||void 0===t?void 0:null===(n=t.user)||void 0===n?void 0:n.id]);(0,d.useEffect)(function(){var e,t=!1,n=(e=(0,r.Z)(function(){var e,n,r;return(0,o.__generator)(this,function(i){switch(i.label){case 0:return I(!0),[4,S(0)];case 1:return n=(e=i.sent()).newImages,r=e.newCursor,t||(j(r),h(n),I(!1)),[2]}})}),function(){return e.apply(this,arguments)});return M.current.sortBy!==m&&(M.current.sortBy=null,n()),M.current.filter!==f&&(M.current.filter=null,n()),function(){t=!0}},[m,f]);var _=(0,d.useCallback)((0,r.Z)(function(){var e,t,n;return(0,o.__generator)(this,function(n){switch(n.label){case 0:return[4,S(w)];case 1:return t=(e=n.sent()).newImages,j(e.newCursor),setTimeout(function(){return h(function(e){return(0,s.Z)(e).concat((0,s.Z)(t))})},0),[2,t]}})}),[w,S]);return{images:p,getMoreImages:_,haveMoreImages:void 0!==w,setImages:h,showEmptyImages:k}},j=n(40247),C=n(8683),Z=n(65638),k=n(8654),I=n(24623),M=n(94978),S=n.n(M);function _(e){var t=e.deleteImages,n=e.numSelected,r=(0,I.d)().closeModal,i=(0,j.bJ)();return(0,l.jsxs)(k.Z,{onSubmit:function(e){e.preventDefault(),t()},children:[(0,l.jsx)(k.Z.Header,{children:(0,l.jsx)(k.Z.HeaderTitle,{children:"Are you sure you want to delete ".concat(n," ").concat(n>1?"images":"image","?")})}),(0,l.jsx)(k.Z.Body,{children:"Deleting images will permanently remove them and you will not be able to recover them later."}),(0,l.jsxs)(k.Z.Footer,{children:[(0,l.jsx)(k.Z.Cancel,{onClick:r,disabled:i}),(0,l.jsx)(k.Z.Submit,{className:S().DeleteButton,disabled:i,children:i?(0,l.jsx)(Z.ZP,{smallest:!0,flex:!0}):"Delete"})]})]})}function N(e){var t=e.error,n=(0,I.d)().closeModal;return(0,l.jsxs)(k.Z,{onSubmit:function(e){e.preventDefault(),n()},children:[(0,l.jsx)("div",{className:"flex px-8"}),(0,l.jsx)(k.Z.Header,{children:(0,l.jsx)(k.Z.HeaderTitle,{children:"Cannot complete download"})}),(0,l.jsx)(k.Z.Body,{children:t}),(0,l.jsx)(k.Z.Footer,{children:(0,l.jsx)(k.Z.Submit,{children:"Okay"})})]})}var E=n(86010),L=n(13173),P=n(10435),W=n(81575),B=n(62469),A=n(76799),T=n(34206);function D(e){var t=e.disabled,n=(0,j.a5)(),r=(0,d.useState)(null),i=r[0],a=r[1],s=(0,j.dW)(function(e){return e.images.every(function(e){return!e.private})}),o=(0,j.dW)(function(e){return e.images.every(function(e){return e.private})}),u=!(0,T.Z)();return(0,l.jsx)(W.t3.MenubarRoot,{children:(0,l.jsxs)(P.v2,{children:[(0,l.jsx)(W.t3.MenubarTrigger,{className:"primary text-gray-50 w-[36px] hover:bg-gray-80 rounded-md disabled:pointer-events-none disabled:cursor-default flex items-center justify-center",disabled:t,children:(0,l.jsx)(B.AjK,{className:"w-4 h-4 "})}),(0,l.jsx)(P.h_,{children:(0,l.jsxs)(W.t3.MenubarContent,{align:"end",side:window.innerWidth>1100?"right":"top",sideOffset:15,alignOffset:window.innerWidth>1100?-27:-10,children:[(0,l.jsxs)(W.t3.MenubarItem,{disabled:n||s,className:"flex items-center disabled:text-gray-50",onClick:function(){a("public"),j.dW.getState().setPrivacy(!1)},children:["Make public"," ",n&&"public"===i&&(0,l.jsx)(Z.ZP,{smallest:!0,flex:!0,className:"ml-2"})]}),(0,l.jsx)(A._,{open:!!u&&!n&&!o&&void 0,label:"This feature is only available to Pro users",mixpanelKey:"Change Privacy (Profile bulk action)",alignOffset:-25,sideOffset:10,children:(0,l.jsxs)(W.t3.MenubarItem,{disabled:n||o,className:"flex items-center disabled:text-gray-50",onClick:function(){u||(a("private"),j.dW.getState().setPrivacy(!0))},children:["Make private"," ",n&&"private"===i&&(0,l.jsx)(Z.ZP,{smallest:!0,flex:!0,className:"ml-2"})]})})]})})]})})}function F(e){e.selectAll,e.allAreSelected;var t=e.allowEdits,n=void 0===t||t,r=e.deletedCallback,i=(0,j.dW)(function(e){return e.active}),a=(0,j.Le)(),s=(0,j.uh)(),o=(0,I.d)(),u=o.setModalContent,d=o.closeModal,c=o.isModalOpen,m=function(){u((0,l.jsx)(_,{deleteImages:function(){var e=j.dW.getState(),t=e.images.map(function(e){return e.id});setTimeout(function(){r(t),d()},300),e.delete()},numSelected:a}))},f=function(e){u((0,l.jsx)(N,{error:e}))};return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:(0,E.Z)("flex fixed min-w-[600px] left-[50%] bg-gray-90 p-[10px] text-sm font-medium rounded-[10px] items-center z-[".concat(C.KN.SELECT_POPOVER,"]"),"border-[1px] border-gray-80","transition transition-all translate-y-full ease-in-out",i?"bottom-8":"-bottom-20"),style:{transform:"translate(-50%, 0)",boxShadow:"0px 0px 16px 0px rgba(0, 0, 0, 0.56), 0px 4px 24px 0px rgba(0, 0, 0, 0.25)"},children:[(0,l.jsxs)("div",{className:"flex items-center ml-1 gap-4 font-semibold text-gray-10",children:[(0,l.jsx)("button",{className:"text-gray-50 hover:bg-gray-80 rounded-md p-1",onClick:j.dW.getState().reset,disabled:s||c,children:(0,l.jsx)(L.Z,{})}),"".concat(a," selected")]}),(0,l.jsx)("div",{className:"flex-grow"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[n&&(0,l.jsx)("button",{className:"marketing-button secondary",onClick:m,disabled:0===a||s||c,children:"Delete"}),(0,l.jsx)("button",{className:"marketing-button primary min-w-[120px]",onClick:function(){j.dW.getState().download(f)},disabled:0===a||s||c,children:s?(0,l.jsx)(Z.ZP,{smallest:!0,flex:!0}):"Download"}),n&&(0,l.jsx)(D,{disabled:0===a||s||c})]})]})})}var O=n(34031),H=n(55043),R={300:1,400:2,800:3,1200:4,1600:5,3e3:7,3400:8,4e3:9};function K(e){var t,n,g=e.className,x=e.initialImages,b=e.initialCursor,y=e.options,C=e.sortBy,Z=e.filter,k=e.emptyState,M=e.groupBatchedImages,S=void 0!==M&&M,_=e.hideProfileImages,N=void 0!==_&&_,E=e.scrollThreshold,L=(0,d.useState)(null),P=L[0],W=L[1],B=(0,d.useState)(!1),A=B[0],T=B[1],D=(0,d.useState)(null),K=D[0],q=D[1],z=(0,v.useRouter)(),V="/profile/likes/[id]"===z.pathname,J=w({initialImages:x,initialCursor:b,options:y,sortBy:C,filter:Z}),Q=J.haveMoreImages,U=J.getMoreImages,Y=J.setImages,G=J.images,X=J.showEmptyImages,$=(0,h.g)().setImageData,ee=(0,I.d)(),et=ee.isModalOpen,en=ee.closeModal,er=H.t.useUserHasPermission("moderation:images:private"),ei=(0,d.useCallback)((t=(0,r.Z)(function(e,t){var n,r,i,a=arguments;return(0,o.__generator)(this,function(s){return n=!(a.length>2)||void 0===a[2]||a[2],r=a.length>3&&void 0!==a[3]&&a[3],W(t),$(e),i=e.id,z.query.postId=i,r&&z.push(z,"/post/".concat((0,O.Td)(e)),{shallow:!0}),n&&localStorage.setItem("modal-return-to",z.asPath),[2]})}),function(e,n){return t.apply(this,arguments)}),[z,$]),ea=(0,p.Z)(),es=(0,d.useMemo)(function(){var e=[];return G.forEach(function(t){if(!t.hide){var n=e.find(function(e){return e.id===t.batchId});n?n.images.length<4&&n.images.push(t):e.push({id:S&&t.batchId?t.batchId:t.id,images:[t]})}}),e},[G,S]),eo=(0,d.useCallback)((n=(0,r.Z)(function(e){var t,n,r,i;return(0,o.__generator)(this,function(a){switch(a.label){case 0:if(!(null!==P)||((t=P+e)>=0&&t<G.length&&(null===(n=es[t].images)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r.id)&&ei(null===(i=es[t].images)||void 0===i?void 0:i[0],t,!1,!0),!(t>=G.length-2)))return[3,2];return[4,U()];case 1:a.sent(),a.label=2;case 2:return[2]}})}),function(e){return n.apply(this,arguments)}),[es,U,G.length,ei,P]);(0,d.useEffect)(function(){return j.dW.getState().reset},[]),(0,d.useEffect)(function(){var e,t,n=(e=(0,r.Z)(function(e){var t;return(0,o.__generator)(this,function(n){switch(null===(t=e.key)||void 0===t?void 0:t.toLowerCase()){case"arrowleft":case"arrowright":if(!(null==z?void 0:z.query.postId))break;eo("ArrowRight"===e.key?1:-1);break;case"shift":console.log("Multi-select: on"),T(!0);break;case"escape":et?en():j.dW.getState().reset()}return[2]})}),function(t){return e.apply(this,arguments)});document.addEventListener("keydown",n);var i=(t=(0,r.Z)(function(e){var t;return(0,o.__generator)(this,function(n){return(null===(t=e.key)||void 0===t?void 0:t.toLowerCase())==="shift"&&(console.log("Multi-select: off"),T(!1)),[2]})}),function(e){return t.apply(this,arguments)});return document.addEventListener("keyup",i),function(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",i)}},[G,eo,null==z?void 0:z.query.postId,P,et,en,]),(0,d.useEffect)(function(){var e=function(){return eo(1)},t=function(){return eo(-1)};return document.addEventListener("pai:modal:next",e),document.addEventListener("pai:modal:prev",t),function(){document.removeEventListener("pai:modal:next",e),document.removeEventListener("pai:modal:prev",t)}},[eo]);var el=(0,d.useMemo)(function(){return G.some(function(e){return e.hide})},[G]),eu=function(e,t){Y(function(n){return n.map(function(n){return t.includes(n.id)?(0,a.Z)((0,i.Z)({},n),{hide:e}):n})})},ed=(0,f.Lm)().width,ec=(0,d.useMemo)(function(){return(0,f.QN)(ed,R)},[ed]),em=(0,j.dW)(function(e){return e.active}),ef=function(){var e=G.map(function(e){return{id:e.id,url:e.url,prompt:e.prompt,private:e.private,publishedFromCanvas:e.fromCanvas}});j.dW.getState().selectAll(e)},ev=(0,j.Le)()===G.length,ep=function(e){var t=e.col;return e.row*ec+t},eh=(0,d.useMemo)(function(){var e=-1,t={0:0,1:0,2:0,3:0,4:0};G.length;var n={};return es.forEach(function(r){var i=(e+=1)%ec,a=t[i];t[i]+=2===r.images.length?1:2,r.images.forEach(function(e,t){n[e.id]={col:i+([1,3].includes(t)?.5:0),row:a+([0,1].includes(t)?0:1)}})}),n},[es,G.length,ec,Q]),eg=function(e){var t=j.dW.getState();if(!t.downloadLoading&&!t.deleteLoading){if(t.isSelected(e.id))t.deselect(e.id);else{q(e.id);var n={id:e.id,url:e.url,prompt:e.prompt,private:e.private,publishedFromCanvas:e.fromCanvas};if(A&&t.images.length&&K){if(A){var r=eh[K],i=eh[e.id],a=ep(r),o=ep(i);if(o>a){var l=G.filter(function(e){return!e.hide}).filter(function(e){return ep(eh[e.id])>=a&&ep(eh[e.id])<=o}).map(function(t){return{id:t.id,url:t.url,prompt:t.prompt,private:t.private,publishedFromCanvas:e.fromCanvas}});t.selectAll((0,s.Z)(t.images).concat((0,s.Z)(l.filter(function(e){return!t.images.some(function(t){return t.id===e.id})}))))}else if(o<a){var u=G.filter(function(e){return!e.hide}).filter(function(e){return ep(eh[e.id])>=o&&ep(eh[e.id])<=a}).map(function(t){return{id:t.id,url:t.url,prompt:t.prompt,private:t.private,publishedFromCanvas:e.fromCanvas}});t.selectAll((0,s.Z)(t.images).concat((0,s.Z)(u.filter(function(e){return!t.images.some(function(t){return t.id===e.id})}))))}}}else t.select(n)}}};return ea?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.Z,{className:g,dataLength:G.length,next:U,hasMore:Q,loader:(0,l.jsx)(l.Fragment,{}),style:{overflow:"visible"},scrollThreshold:void 0===E?.8:E,children:(0,l.jsx)(f.ZP,{columnsCountBreakPoints:R,children:es.length&&!X?(0,l.jsx)(u.Z,{gutter:"16px",children:es.map(function(e,t){var n=Math.min(e.images.length,2);return(0,l.jsx)("div",{className:"grid gap-1",style:{gridTemplateColumns:"repeat(".concat(n,", minmax(0, 1fr))")},children:e.images.map(function(e){var r,i,a,s;return(0,l.jsx)(m.F,{id:e.id,aspectRatio:(null!==(r=e.width)&&void 0!==r?r:1)/(null!==(i=e.height)&&void 0!==i?i:1),prompt:n>1?"":e.prompt,showPrompt:!0,url:e.url,url_jpeg:e.url_jpeg,title:e.title,isPrivate:e.private,createdAt:e.createdAt,source:e.source,user:{id:e.user.id,name:e.user.displayName,avatar:e.user.image},hideImage:N,isLiked:null!==(a=e.userLiked)&&void 0!==a&&a,numLikes:null!==(s=e.likeCount)&&void 0!==s?s:0,fromCanvas:e.fromCanvas,onClick:function(n){if(em){eg(e);return}A&&(console.log("Multi-select: off [2]"),T(!1)),n.metaKey||A||ei(e,t)},setHidden:eu,forceVisible:el,parent_image_url:e.parent_image_url},e.id)})},e.id)})}):(0,l.jsx)("p",{className:"text-gray-400 p-10",children:k||X||"No images."})})}),(0,l.jsx)(F,{selectAll:ef,allAreSelected:ev,deletedCallback:function(e){return eu(!0,e)},allowEdits:!V||er})]}):null}},40006:function(e,t,n){"use strict";n.d(t,{Lm:function(){return o},QN:function(){return l}});var r=n(828),i=n(85893),a=n(13344),s=n(67294),o=function(){var e=(0,a.Z)(),t=(0,s.useState)(0),n=t[0],r=t[1],i=(0,s.useCallback)(function(){e&&r(window.innerWidth)},[e]);return(0,s.useLayoutEffect)(function(){if(e)return window.addEventListener("resize",i),i(),function(){return window.removeEventListener("resize",i)}},[e,i]),{width:n,hasMounted:e}};function l(e,t){var n=1;return Object.entries(t).sort(function(e,t){var n=(0,r.Z)(e,1)[0];return parseInt((0,r.Z)(t,1)[0])-parseInt(n)}).some(function(t){var i=(0,r.Z)(t,2),a=i[0],s=i[1];return e>=parseInt(a)&&(n=s,!0)}),n}var u=function(e){var t=e.columnsCountBreakPoints,n=e.children,r=e.className,a=e.style,u=o(),d=u.width,c=u.hasMounted,m=(0,s.useMemo)(function(){return l(d,t)},[t,d]);return(0,i.jsx)("div",{className:r,style:a,children:c?s.Children.map(n,function(e,t){return s.cloneElement(e,{key:t,columnsCount:m})}):null})};t.ZP=u},94978:function(e){e.exports={DeleteButton:"DeleteCanvas_DeleteButton__VYwTJ"}}}]);